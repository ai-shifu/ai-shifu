"""init admin user

Revision ID: 66625b9dd851
Revises: a23867eba134
Create Date: 2024-08-12 15:01:43.015750

"""

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision = "66625b9dd851"
down_revision = "a23867eba134"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "admin_info",
        sa.Column(
            "id",
            mysql.BIGINT(),
            autoincrement=True,
            nullable=False,
            comment="Unique ID",
        ),
        sa.Column("user_id", sa.String(length=36), nullable=False, comment="User UUID"),
        sa.Column(
            "username", sa.String(length=255), nullable=False, comment="Login username"
        ),
        sa.Column(
            "name", sa.String(length=255), nullable=False, comment="User real name"
        ),
        sa.Column(
            "password_hash",
            sa.String(length=255),
            nullable=False,
            comment="Hashed password",
        ),
        sa.Column("email", sa.String(length=255), nullable=False, comment="Email"),
        sa.Column("mobile", sa.String(length=20), nullable=False, comment="Mobile"),
        sa.Column("created", sa.TIMESTAMP(), nullable=False, comment="Creation time"),
        sa.Column("updated", sa.TIMESTAMP(), nullable=False, comment="Update time"),
        sa.Column(
            "default_model",
            sa.String(length=255),
            nullable=False,
            comment="Default model",
        ),
        sa.Column("user_state", sa.Integer(), nullable=True, comment="User_state"),
        sa.Column("user_sex", sa.Integer(), nullable=True, comment="user sex"),
        sa.Column("user_birth", sa.Date(), nullable=True, comment="user birth"),
        sa.Column(
            "user_avatar", sa.String(length=255), nullable=True, comment="user avatar"
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    with op.batch_alter_table("discount", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column(
                "discount_apply_type",
                sa.Integer(),
                nullable=False,
                comment="Discount apply type: 801-all, 802-specific",
            )
        )
        batch_op.alter_column(
            "discount_type",
            existing_type=mysql.INTEGER(),
            comment="Discount type: 701-fixed, 702-percent",
            existing_comment="Discount type: 0-percent, 1-amount",
            existing_nullable=False,
        )
        batch_op.alter_column(
            "discount_generated_user",
            existing_type=mysql.BIGINT(),
            type_=sa.String(length=36),
            existing_comment="Discount generated user",
            existing_nullable=False,
        )

    with op.batch_alter_table("discount_record", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column(
                "order_id", sa.String(length=36), nullable=False, comment="Order UUID"
            )
        )
        batch_op.create_index(
            batch_op.f("ix_discount_record_order_id"), ["order_id"], unique=False
        )

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table("discount_record", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_discount_record_order_id"))
        batch_op.drop_column("order_id")

    with op.batch_alter_table("discount", schema=None) as batch_op:
        batch_op.alter_column(
            "discount_generated_user",
            existing_type=sa.String(length=36),
            type_=mysql.BIGINT(),
            existing_comment="Discount generated user",
            existing_nullable=False,
        )
        batch_op.alter_column(
            "discount_type",
            existing_type=mysql.INTEGER(),
            comment="Discount type: 0-percent, 1-amount",
            existing_comment="Discount type: 701-fixed, 702-percent",
            existing_nullable=False,
        )
        batch_op.drop_column("discount_apply_type")

    op.drop_table("admin_info")
    # ### end Alembic commands ###
