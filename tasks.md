# Local storage fallback (no OSS)

- [x] Define a unified storage abstraction (provider-based: `oss`, `local`, `auto`)
- [x] Implement `oss` provider adapter (reuse existing `oss_utils`)
- [x] Implement `local` provider (write to server filesystem)
- [x] Add a public file serving endpoint for local storage (compatible with `PATH_PREFIX`)
- [x] Wire Shifu file uploads (`/shifu/upfile`, `/shifu/url-upfile`) to the storage layer
- [x] Wire TTS final audio upload to the storage layer (store URL + object key)
- [x] Add config items:
  - [x] `STORAGE_PROVIDER` (`auto`/`oss`/`local`)
  - [x] `LOCAL_STORAGE_ROOT` (filesystem path inside container)
- [x] Add Docker Compose volume mappings for local storage in:
  - [x] `docker/docker-compose.yml`
  - [x] `docker/docker-compose.latest.yml`
  - [x] `docker/docker-compose.dev.yml`
- [x] Add/extend tests:
  - [x] Provider resolution (`auto` fallback when OSS not configured)
  - [x] Local provider writes file + returns a reachable URL path
  - [x] Local file serving route returns expected content type / bytes
- [x] Run `pre-commit run -a` and `pytest`
- [x] Commit each item atomically with passing tests
